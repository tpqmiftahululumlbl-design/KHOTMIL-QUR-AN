<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Laporan Keuangan Khotmil Qur'an</title>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{font-family:system-ui}
</style>
</head>

<body class="bg-slate-100 min-h-screen p-4">

<div class="max-w-6xl mx-auto space-y-4">

<!-- HEADER -->
<div class="bg-white p-5 rounded-xl shadow text-center">
<h1 class="text-xl font-bold">KHOTMIL QUR'AN</h1>
<h2 class="text-lg">TPQ MIFTAHUL ULUM LANBULAN</h2>
<p class="text-sm text-slate-500">Laporan Keuangan Online</p>
</div>

<!-- RINGKASAN -->
<div class="grid md:grid-cols-3 gap-3">
<div class="bg-green-500 text-white p-4 rounded">Pemasukan<br><b id="inTotal">Rp 0</b></div>
<div class="bg-red-500 text-white p-4 rounded">Pengeluaran<br><b id="outTotal">Rp 0</b></div>
<div class="bg-blue-500 text-white p-4 rounded">Saldo<br><b id="saldo">Rp 0</b></div>
</div>

<!-- FORM INPUT -->
<div class="bg-white p-4 rounded shadow">
<h3 class="font-bold mb-2">Input Transaksi (Admin)</h3>
<div class="grid md:grid-cols-6 gap-2">
<input id="tanggal" type="date" class="border p-2 rounded">
<select id="kategori" class="border p-2 rounded">
<option>INFAQ</option><option>KONSUMSI</option><option>SOUNDSYSTEM</option>
<option>PANGGUNG</option><option>TEROP</option><option>KURSI</option>
<option>BANER & DEKORASI</option><option>LAIN-LAIN</option>
</select>
<input id="masuk" type="number" placeholder="Pemasukan" class="border p-2 rounded">
<input id="keluar" type="number" placeholder="Pengeluaran" class="border p-2 rounded">
<input id="ket" placeholder="Keterangan" class="border p-2 rounded md:col-span-2">
</div>
<button onclick="kirim()" class="mt-3 bg-green-600 text-white px-4 py-2 rounded">
Simpan ke Spreadsheet
</button>
<p id="status" class="text-sm mt-2"></p>
</div>

<!-- GRAFIK -->
<div class="bg-white p-4 rounded shadow">
<canvas id="grafik"></canvas>
</div>

<!-- TABEL -->
<div class="bg-white p-4 rounded shadow">
<h3 class="font-bold mb-2">Data Transaksi</h3>
<div class="overflow-auto">
<table class="w-full text-sm">
<thead class="bg-slate-200">
<tr>
<th>Tanggal</th><th>Kategori</th><th>Masuk</th><th>Keluar</th><th>Keterangan</th>
</tr>
</thead>
<tbody id="list"></tbody>
</table>
</div>
</div>

</div>

<script>
const API="https://script.google.com/macros/s/AKfycbz8a-FAlgdi7VXommjdLLEBm-hJJkbWHvbp3Vb6RQ74jR7hwcEE9KxYyLKRLZoaSe5K/exec"

const ctx=document.getElementById('grafik')
let chart=new Chart(ctx,{type:'bar',data:{labels:['Masuk','Keluar'],datasets:[{data:[0,0],backgroundColor:['#22c55e','#ef4444']} ]}})

function rupiah(n){return "Rp "+Number(n).toLocaleString('id-ID')}

async function kirim(){
status.innerText="Menyimpan..."
let data={
tanggal:tanggal.value,
kategori:kategori.value,
pemasukan:+masuk.value||0,
pengeluaran:+keluar.value||0,
keterangan:ket.value
}

await fetch(API,{
method:"POST",
body:JSON.stringify(data)
})

status.innerText="âœ… Data tersimpan di Spreadsheet"
tanggal.value=masuk.value=keluar.value=ket.value=""
loadData()
}

async function loadData(){
let res=await fetch(API)
let rows=await res.json()

let masukT=0, keluarT=0
list.innerHTML=""

rows.reverse().forEach(r=>{
masukT+=Number(r[2])
keluarT+=Number(r[3])
list.innerHTML+=`
<tr class="border-b">
<td>${r[0]}</td>
<td>${r[1]}</td>
<td>${rupiah(r[2])}</td>
<td>${rupiah(r[3])}</td>
<td>${r[4]}</td>
</tr>`
})

inTotal.innerText=rupiah(masukT)
outTotal.innerText=rupiah(keluarT)
saldo.innerText=rupiah(masukT-keluarT)

chart.data.datasets[0].data=[masukT,keluarT]
chart.update()
}

loadData()
</script>

</body>
</html>
